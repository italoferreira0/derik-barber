{% extends 'base_funcionario.html' %}
{% load static %}

{% block content %}
<div class="container-fluid">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="mb-1">
            <i class="fas fa-clock me-2"></i>
            Gerenciar Horários de Funcionamento
          </h2>
          <p class="text-white mb-0">Configure os dias e horários de funcionamento da barbearia</p>
        </div>
        <a href="{% url 'index_funcionario' %}" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-1"></i>
          Voltar
        </a>
      </div>
    </div>
  </div>

  <!-- Mensagens -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-triangle{% endif %} me-2"></i>
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <!-- Formulário de Horários -->
  <div class="row ">
    <div class="col-lg-8 mt-3">
      <div class="card">
        <div class="card-header text-white" >
          <h5 class="mb-0">
            <i class="fas fa-calendar-week me-2"></i>
            Configuração Semanal
          </h5>
        </div>
        <div class="card-body ">
          <form method="post" id="horariosForm">
            {% csrf_token %}
            
            {% for dia_info in dias_com_horarios %}
              <div class="row mb-4 p-3 border rounded {% if dia_info.ativo %}bg-dark{% endif %}">
                <div class="col-md-3">
                  <div class="form-check form-switch">
                    <input class="form-check-input dia-checkbox" 
                           type="checkbox" 
                           id="dia_{{ dia_info.dia }}_ativo" 
                           name="dia_{{ dia_info.dia }}_ativo"
                           {% if dia_info.ativo %}checked{% endif %}>
                    <label class="form-check-label fw-bold" for="dia_{{ dia_info.dia }}_ativo">
                      {{ dia_info.nome_dia }}
                    </label>
                  </div>
                </div>
                
                <div class="col-md-4">
                  <label for="dia_{{ dia_info.dia }}_inicio" class="form-label">Hora de Início</label>
                  <input type="time" 
                         class="form-control horario-input" 
                         id="dia_{{ dia_info.dia }}_inicio" 
                         name="dia_{{ dia_info.dia }}_inicio"
                         value="{{ dia_info.hora_inicio }}"
                         {% if not dia_info.ativo %}disabled{% endif %}>
                </div>
                
                <div class="col-md-4">
                  <label for="dia_{{ dia_info.dia }}_fim" class="form-label">Hora de Fim</label>
                  <input type="time" 
                         class="form-control horario-input" 
                         id="dia_{{ dia_info.dia }}_fim" 
                         name="dia_{{ dia_info.dia }}_fim"
                         value="{{ dia_info.hora_fim }}"
                         {% if not dia_info.ativo %}disabled{% endif %}>
                </div>
                
                <div class="col-md-1 d-flex align-items-end">
                  <div class="status-indicator">
                    <i class="fas fa-circle text-{% if dia_info.ativo %}success{% else %}muted{% endif %}"></i>
                  </div>
                </div>
              </div>
            {% endfor %}
            
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                <i class="fas fa-undo me-1"></i>
                Limpar
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save me-1"></i>
                Salvar Horários
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Preview dos Horários -->
    <div class="col-lg-4 mt-3">
      <div class="card">
        <div class="card-header text-white">
          <h5 class="mb-0">
            <i class="fas fa-eye me-2"></i>
            Preview dos Horários
          </h5>
        </div>
        <div class="card-body ">
          <div id="preview-horarios">
            <p class="text-muted text-center">Marque os dias para ver o preview</p>
          </div>
        </div>
      </div>

      <!-- Dicas -->
      <div class="card mt-3 mb-3">
        <div class="card-header bg-warning text-dark">
          <h6 class="mb-0">
            <i class="fas fa-lightbulb me-2"></i>
            Dicas
          </h6>
        </div>
        <div class="card-body">
          <ul class="list-unstyled mb-0 small">
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Marque apenas os dias que a barbearia funcionará
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Clientes não poderão agendar em dias desmarcados
            </li>
            <li class="mb-2">
              <i class="fas fa-check text-success me-2"></i>
              Horários são gerados automaticamente a cada 30 minutos
            </li>
            <li class="mb-0">
              <i class="fas fa-check text-success me-2"></i>
              Agendamentos existentes não são afetados
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.dia-checkbox:checked + label {
  color: #198754 !important;
}

.horario-input:disabled {
  background-color: #f8f9fa;
  opacity: 0.6;
}

.horario-input:not(:disabled) {
  background-color: #fff;
  border-color: #198754;
}

.status-indicator {
  font-size: 1.2rem;
}

.preview-item {
  padding: 0.5rem;
  margin-bottom: 0.5rem;
  background-color: gray;
  border-radius: 0.375rem;
  {% comment %} border-left: 4px solid #198754; {% endcomment %}
}

.preview-item.inactive {
  background-color: #000000ff;
  border-left-color: #6c757d;
  color: #d8d8d8ff;
  opacity: 0.6;
}

@media (max-width: 768px) {
  .row.mb-4 .col-md-3,
  .row.mb-4 .col-md-4 {
    margin-bottom: 1rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkboxes = document.querySelectorAll('.dia-checkbox');
    const inputs = document.querySelectorAll('.horario-input');
    
    // Atualiza preview quando checkbox muda
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const dia = this.id.split('_')[1];
            // Busca apenas os inputs de horário, não o próprio checkbox
            const inputs = document.querySelectorAll(`[name="dia_${dia}_inicio"], [name="dia_${dia}_fim"]`);
            
            inputs.forEach(input => {
                input.disabled = !this.checked;
            });
            
            updatePreview();
        });
    });
    
    // Atualiza preview quando horários mudam
    inputs.forEach(input => {
        input.addEventListener('change', updatePreview);
    });
    
    // Atualiza preview inicial
    updatePreview();
});

function updatePreview() {
    const preview = document.getElementById('preview-horarios');
    const dias = ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'];
    let html = '';
    
    for (let i = 0; i < 7; i++) {
        const checkbox = document.getElementById(`dia_${i}_ativo`);
        const inicio = document.getElementById(`dia_${i}_inicio`).value;
        const fim = document.getElementById(`dia_${i}_fim`).value;
        
        if (checkbox.checked && inicio && fim) {
            html += `
                <div class="preview-item">
                    <strong>${dias[i]}</strong><br>
                    <small class="text-muted">${inicio} - ${fim}</small>
                </div>
            `;
        } else {
            html += `
                <div class="preview-item inactive">
                    <strong>${dias[i]}</strong><br>
                    <small class="text-muted">Fechado</small>
                </div>
            `;
        }
    }
    
    preview.innerHTML = html || '<p class="text-muted text-center">Marque os dias para ver o preview</p>';
}

function resetForm() {
    if (confirm('Tem certeza que deseja limpar todos os horários?')) {
        document.querySelectorAll('.dia-checkbox').forEach(checkbox => {
            checkbox.checked = false;
            checkbox.dispatchEvent(new Event('change'));
        });
    }
}
</script>
{% endblock %}
